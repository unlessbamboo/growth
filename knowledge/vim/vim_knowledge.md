---
title: vim知识点

date: 2017-05-25 22:17:11

tags: vim

---

帮助文档: help tutor  
新手教程: vimtutor  
学习之道: 
* 普通思路：发现问题-搜索并查找资料-找到更好的解决方式
* 高级思路：在普通思路的基础上，了解细节和原理，从而更好的理解普通思路，并且提出相应的优化方法
* 扩展思路：根据已有的技术和原理，找出相似问题的解决办法，参与技术和原理的制定

编辑软件: vim/emacs/IDE


### 1 模式
下面的所有章节的操作都是以下面四种模式进行分类，当然，这仅仅是四大类模式而已。
#### 1.1 插入模式
大部分的 **VIM命令** 都是在非插入模式下执行，插入模式一般用于文本输入。
##### 1.1.1 插入-普通模式
该模式非常有用，但是经常忘记。 **插入模式下的一个子模式**。使用<C-o>命令来进入该模式。  

* 进入插入-普通模式：C-O
* 光标所在位置处于屏幕底部，想移动输入点到屏幕中间（非常常见）： ESC + zz + o 或者 <C-o> + zz +继续输入

##### 1.1.2 其他
在插入模式下可以进行计算，插入特殊符号操作。

#### 1.2 普通模式
* 出发点：工程师大部分的时间都是在思考、阅读、浏览，复制、移动，仅仅进行少量的写入操作
* 一次操作：[前缀字符] + 操作符 + motion(动作命令)
* 语法规则：任何一个操作符命令被连续调用两次时，它会作用于当前行，例如>>、dd、gUU（即gUgU）等命令

##### 1.2.1 操作符待决
（Operator-Pending), 一个仅仅接收动作命令的状态，在调用操作符的时候被激活，之后等待后续的动作命令。  
进入待决模式：操作数 + 待决模式 + {动作命令}， 例如d + OPM + {motion}, gu + OPM + {motion}  
终止待决模式: d + OPM + ESC

##### 1.2.2 替换模式
说明：类似于office word中的Insert模式，替换光标所在的字符   
命令：r/R/s/S

#### 1.3 可视模式
普通模式：operator + motion，先出发修改命令，在限定选区。  
可视模式：motion + operator，先限定选区，之后执行命令（合理的三观啊）。 
##### 1.3.1 说明
```vim
    " 说明：对选中的文本进行操作，大部分的命令同普通模式一样，例如h/j/k/l、f{char}、;/,重复f{char}、n/N查找等
    v                    " 字符可视模式
    V                    " 行可视模式
    <C_v>                " 列块可视模式
    gv                   " 重新选择上次的高亮选区（这个蛮有用的）
    o                    " 切换选区的头尾（非常棒的命令）
```

##### 1.3.2 选择模式
选择模式是另一种可视化模式，用于对选择的文本进行快速的删除和替换操作。  
选中一段文本后，输入任何键会替换原有的所有选择字符，类似于 **windows下的选择模式**。
```vim
    " 1 命令
    gh                     " 字符选择模式，删除选中的字符并进入插入模式，只能通过方向键、Ctrl来选择文本
    gH                     " 行选择模式(替换整行)
    g<C_H>                 " 块选择模式


    " 2 模式转换
    " 在选择模式下使用鼠标操作，设置如下选项
    set selectmode=mouse

    " 附加：该选择模式一般用于迎合想让vim编辑器像windows的其他文本编辑器的用户
    " 选择模式到可视化模式
    <C-O>
    " 可视化模式到选择模式
    <C-G>           
```

#### 1.6 命令行模式
说明：按下 *:*进入命令行模式，在命令行模式中执行的命令称为**Ex命令**  
***传承***：ed文本编辑---->ex行编辑器---->vi（可视化）------->vim（vi improved）。  

##### 1.6.1 命令行窗口
* 普通模式到ex窗口： q: （非常棒的命令，查找过去的记录）
* 普通模式到ex历史记录： q/
* 命令行模式到命令行窗口： <c-f>

##### 1.6.2 范围
```vim
    n                       " 移动到光标的第n行
    " {start},{end}         " 选择指定方位，其中.表示当前行，$代表最后一行
    %                       " 所有行
    " /<div>/,/<\div>/      表示<div> .... <\div>之间的文本
```

##### 1.6.3 motion
```vim
    t                       " 复制文本
    co                      " 复制文本
    m                       " 移动文本

    @-ex                    " 重复执行Ex命令        

    <c-r><c-w>              " 在命令行中插入光标下的单词
    normal d                " 执行普通模式命令
```

#### 1.7 命令空间
功能：（自定义命名集）  
说明：namespace用于扩充可用命令的数目  
结果：有点类似于对命令的命名归类，从而更加细化命令，扩充vim词汇量，对普通模式的扩充

### 2 Delete
#### 2.1 ''之间字符
```txt
    使用vim中的文本对象选区功能，涉及到的命令有：
        i和a，其中i选定文本对象之间的内容，注意，这里的i和a并不是动作命令
    删除''之间的字符之后进行插入操作：ci'
```

#### 2.2 行尾空格
```vim
    " \s在正则中表示所有的空格，即\s\+$匹配所有末尾的空格
    %s/\s\+$//g
```

#### 2.3 进入输入模式
```vim
    cc       " 删除一行（特殊的语法规则）
    C        " 删除从光标到行尾的所有字符（等同于c$）
    s        " 删除当前cursor下的字符，进入insert模式（等同于cl）
    S        " 删除当前cursor所在的行，进入insert模式（等同于^C、^c$）
```

#### 2.4 删除motion
```vim
    cw       " 删除一个单词，进入insert模式
    daw      " 非常棒的命令，aw表示作用对象是当前光标所在的整个单词，例如vaw、caw、gUaw
```

#### 2.5 删除单词（重要）
在插入模式下使用，无需进行插入-选择模式操作就可以达到目的
```vim
    <C-h>     删除前一个字符
    <C-w>     删除前一个单词
    <C-u>     删除到行首
```

### 3 Insert
#### 3.1 移动插入
```vim
    i           " 光标首插入
    A           " 行尾部插入，该命令非常有用（等同于$a的集合体）
    wa          " 自定义的命令连用，先移动，之后进行插入操作
    o           " 新建一行，并进入插入模式（等同于A+<CR>）
    O           " 上方新建一行，并进入插入模式（等同于ko，或者k$a<CR>，千万别学后者）
    
    " 重复基本步骤：
    "    方式1：移动+插入操作、移动+宏操作（.）
        
    I           " 行首插入
    a           " 光标尾插入
    ea          " 词尾插入
```

#### 3.2 插入选择
进入普通模式，执行一次action，之后再次回到插入模式
```txt
    " 删除一行并重新输入（蛮常用的）
    <C-o> + cc 
```

### 4 Move
#### 4.1 屏幕跳转
**半屏幕**：下移：Ctrl + D， 上移：Ctrl+U  
整个屏幕：ctrl + B、ctrl + F  
逐行条状：<c-e>, <c-y>

#### 4.2 字符跳转
操作对象为行, 当前行到行尾的查找
```vim
    f              " 向前移动光标到字符所在位置
    F              " 向后移动光标到字符所在位置
    t              " 向前移动光标到字符所在位置的前一个位置，注意和f的区别，这用法其实比f{char}有用
    T              " 向后移动光标到字符所在位置的后一个位置
```

#### 4.3 字符串跳转
```vim
    *              " 微型的宏命令，非常有用的命令

    W              " 说明：WROD--所有非空白字符组成的任意长度的串，只要不是空白串
    B
    E
    gE             " 反向，很有用

    w              " 下一个单词的开头
    b              " 反向移动当前单词或者上一个单词的开头
    e              " 当前单词或者下一个单词的结尾
```

#### 4.4 屏幕跳转
```vim
    H              " 屏幕开头
    zt             " 置顶
    zz             " 当前光标所在位置移动到屏幕中间，重画屏幕（多用多用多用）
    zb             " 置底
```

#### 4.5 文本对象选区
说明：i（inside）--选择分隔符内的文本，a（all）--选择包括分隔符在内的文本  
格式：operator + a/i  + 分隔符文本对象
```vim
    a]                       " 一对方括号
    a>                       " 一对尖括号
    a`                       " 一对反引号
    at                       " 一对xml标签，<xml>tags</tml>

    " ***** 范围文本对象，一直没用过，哇哦 *****
    aw                       " 当前单词以及一个空格
    aW                       " 当前字符以及一个空格
    as                       " 当前句子以及一个空格
    ap                       " 当前段落以及一个空格
```

#### 4.6 括号间跳转
说明：在开、闭括号之间跳转  
命令：%  
作用对象：（）、{}、[]  
例子：ft{ --> %  --> r]  -->``  --> r[        将{}更改为[]，使用到%以及``标记命令  

### 5 update
Change what? Operator is what?
#### 5.1 普通模式
一次修改可以是字符、整行、整个文件，一次修改==最后一次命令 + motion
```vim
    x           " 作用于字符
    dd          " 作用于行对象
    >G          " 作用于整个文件（缩进+G组合命令）
```

#### 5.2 插入模式
一次修改==进入插入模式+...+ESC结束（包含进入insert模式的最后一个命令）  
注意：如果发生光标移动，则会重置修改状态

#### 5.3 可视模式
一次修改==进入可视模式+选择对象+...+ESC（如果进入插入模式）

#### 5.4 替换模式
注意：使用r产生了一个非常棒的方法，利用r+Enter键，进行换行操作，只不过会删除当前cursor下的字符
```vim
    r        " 当前cursor下的字符
    R        " 一直更改，直到ESC
```

已退为进，完成离散的更改, 即换一种思维或者思路，推倒重来，例如在一个“+”的前后加上空格
```vim
    " 操作过程
    f+              " 查找，此时该命令记录到命令缓存中
    dw              " 执行update操作, ESC退出
    ;.              " 来重复修改
```

### 6 缩进以及大小写
#### 6.1 普通模式
左缩进：<  
右缩进：>  
自动缩进：=  
左缩进当前行：<<  
右缩进当前行：>>  
缩进整个文件：gg>G  
注意：如果没有使用后面的特殊语法，则缩进操作符后面必须紧跟动作命令，否则处于“操作符待决模式”下。  

#### 6.2 插入模式下
左缩进：Ctrl + D  
右缩进：Ctrl + T

#### 6.3 大小写转换
反转：               g~  
小写：               gu  
大写：               gU  
小写整行：           guu  
大写整行：           gUU  
注意：这里的操作对象类似于缩进中的说明。

### 7 undo/redo
把握好撤销的力度。
#### 7.1 命令
```vim
    u           " 一直往后撤销
    U           " 撤销当前行的所有修改，之后就一直循环
    ctrl + R    " Redo操作
```

#### 7.2 撤销粒度
将撤销单元尽可能的切成规整的小块单元，保证撤销的粒度在合理且高效的处理范围内。  
```txt
    输入一长串的字符串（超过一百行），此时发现最后的50个字符出错，如果使用u命令，会撤销所有输入
    a) 如果停顿（画家开始构思了），构建断点，ESC，之后可以使用A重新开始输入
    b) 在连续性的多行操作时，将<ER>换成ESC+o
```

#### 7.3 重置粒度
类似于'.'范式中一次修改动作的重置，在插入模式下如果使用光标键（上下作用），则断点会发生重置


### 8 inclusive/enclusive
#### 8.1 inclusive（包含的）
所有的操作都会影响到当前cursor下的字符

#### 8.2 enclusive（非包含的）
所有的操作都只会影响到当前cursor的前一个字符

#### 8.3 分类


### 9 重复性
vim本身对重复性操作进行了优化，记录最近的操作，之后使用极为精短的按键就可以重复之前的工作。  
注意：对于每一个重复性工作，必须实现认真规划按键动作，从而完成任务。
#### 9.1 .
微型的宏结构，用于重复一次完整的修改（见上面修改的定义）
* '.'范式：一次按键移动，一次按键motion

#### 9.2 ;和,
微型的宏结构，用于重复查找上次用f命令查找的字符，注意其操作对象是字符，并且和f配合使用，用于光标的移动

#### 9.3 @:
微型的宏结构，在普通模式下通过@+:组合键重复执行上一次的EX命令。
```txt
    首先执行：%normal A kuang 在每一行末尾添加字符串
    重复执行：@:
```

#### 9.4 &
> 该命令经常和@:重合

微型的宏结构或者EX命令，重复上次的:substitute命令哦

#### 9.4 n/N
查找模式下的重复按键（n/N）


### 10 数字和大写键
#### 10.1 数字
##### 10.1.1 增加与减少
```vim
    <C-a>          " 增加
    <C-x>          " 减少
```

##### 10.1.2 运算
插入模式：<C-r>=6*35<CR>

#### 10.2 大写键
```vim
    K               " 查看光标所在的单词的man手册页
    J               " 连接当前行和下一行
```

### 11 寄存器
#### 11.1 查看
```vim
    " 查看寄存器中的内容
    reg "0
    reg
```

#### 11.2 分类
使用寄存器时，都需要如下按键：" + 寄存器名
```vim
    " 无名寄存器
    "x
    "p

    " 引用寄存器（26个英文字母）
    "ayiw            "复制单词到寄存器中
    "ap    

    " 黑洞寄存器
    "_dw

    " 复制专用寄存器
    " 当执行y{motion}时，默认使用该寄存器，

    " 其他寄存器(非常实用）
    "%            " 当前文件名
    "#            " 轮换文件名
    ".            " 上次插入的文本
    ":            " 上次执行的ex命令
    "/            " 上次查找的模式
```

#### 11.3 系统剪贴板
剪贴板和vim之间的操作，系统增加xterm_clipboard编译项支持，mac版安装macvim:  
* 其中*/+剪贴板大体功能类似，在x11系统中，前者存放选中或者高亮的内容，后者存放复制和剪贴的内容
* "*p 命令可以避免使用F7命令的缩进行为(非常棒的方法)
```vim
    " vim-->clipboard
    "*y   或者   "+y
    " +2yy 或者   "+dd

    " {virtual}"+y
    " +y{motion}
    " :[range]yank +

    " clipboard ---> vim（不能是系统cmd+c拷贝的内容哦），避免重复的使用:set paste的按键开销（重要）
    "+p 或者 "*p

    " Shift + Insert
    " 插入模式下的拷贝
    <c-r> + -
```

#### 11.4 插入模式
实际上，如果使用系统剪贴板的话，该章节信息无需了解
##### 11.4.1 粘贴
<C_r>{register}:                    将指定寄存器中的值复制到当前输入位置，例如<C_r>0

##### 11.4.2 数学运算
该用法在C中定义常量以及某些基本运算时非常有用
<C_r>={数学运算式}Enter：                         将值写入当前光标所在位置，例如<C_r>=60*24*365<Enter>

##### 11.4.3 插入非常用字符
（查询ASCII或者UNICODE表）
```txt
    <C_v>{123}:                          以十进制字符编码插入字符
    <C_v>u{1234}:                      以十六进制字符编码插入字符
    <C_v>{nondigit}:                    按原义插入非数字字符
    <C_k>{char1}{char2}:             插入以二合字符标识号的字符（某些字符用两个字符表示出来）
    附加：ga命令用于查询当前光标所在位置字符的编码（10进制、16进制）
```


### 12 ex命令
#### 12.1 delete/yank/put/print
所有选区范围的操作，非常像可视模式选定范围之后的操作，只不过更快捷而已

格式说明：
* total：   [range]put {register}  
* range：   {start}, {end}  
* offset：  {address}+n或者{address}-n  

高亮选区：
```txt
    '<        起始行
    '>        结束行
    例如： '<,'>,：高亮选区所选定的范围，之后添加命令即可，和gv联用非常棒
    例如： .,.+3表示2,5，如果当前行为第二行  
```

命令：
```vim
    0                   " 代表文件第一行的上方（虚拟行）
    .                   " 代表当前行地址；
    %                   " 表示当前缓冲文件的所有行，例如%s命令就是使用该用法；
    "'m                  " 位置标记m所在的行
    " /<html>/, /<\html>/ 使用模式指定范围，非常有用，其中start是/<html>/，end为/<\html>/
```

#### 12.2 copy/move/join
拷贝命令格式：[range]copy to/move {address}、简写为t/m   
连接命令：[range] join，类似大写的J命令

#### 12.3 every line
普通命令：[range] normal {commands}
例子：%normal A；即表示在文件的所有行末尾增加';'字符

替换命令：[range] substitute/{pattern}/{string}/[flags]
例子：[range] s/bamboo/donkey/g

匹配命令并执行普通命令：[range] global/{pattern}/[cmd]

#### 12.4 复制光标字符
```vim
" 单词
<C-r><C-w>

" 字符串，这个经常忘记
<C-r><C-a>
```

#### 12.5 历史记录
设置历史记录: set history=30  
获取上一条ex命令：UP键  
命令行窗口： 一个常规的vim缓冲区，每一行内容都是vim的ex记录，类似shell中的history命令
```vim
    q:                   " 普通模式下输入获取ex历史记录
    q/                   " 普通模式下输入获取查找命令历史记录
    <C-f>                " 命令行模式切换到命令行窗口
    " 操作：对历史命令进行更改，之后执行修改的历史命令
```

#### 12.6 shell命令
说明：在vim中执行shell命令
```txt
    ! {cmd}                  " 执行cmd命令
    read !{cmd}              " 执行cmd命令，并将stdout插入当前光标所在位置
    [range]write !{cmd}      " 执行cmd命令，【range】所在范围的字符串作为stdin
    [range]!{filter}         " 使用外部程序{filter}过滤【range】，例如grep命令
```

#### 12.7 自动补全
* Tab键两次
* CTRL + B 获取所有补全项


### 13 文件操作
删除缓存格式: bdelete begin-n,end-num  
保存缓冲格式: write, wall  
退出检查格式: quit, qall  
退出不检查: qall!  
重载文件格式: 
```vim
    edit!                 " 重新读取文件，删除刚刚所做的更改
    edit %<Tab>           " 获取当前活动缓冲区文件的完整路径（相对）
    edit %:h<Tab>         " 仅仅获取当前活动缓冲区的目录路径 
```

获取当前文件所在的目录
```vim
    conoremap <expr> %% getcmdtype() == ':' ? expand('%:h'). '/' :'%%'
```

文件切割
```vim
    sp                      " 水平切割，并在新窗口中载入file
    vs                      " 垂直切割，并在新窗口中载入file
    <C-w> s                 " 水平切割，在新窗口中任然显示当前缓冲区
    <C-w> v                 " 垂直切割，在新窗口中任然显示当前缓冲区
    
    clo/q                  " 关闭活动窗口
    on                     " 关闭其他窗口（非常有用）  
     
    <C-w>=                  " 使所有窗口等宽、等高
    <C-w>_                  " 最大化活动窗口的高度
    <C-w>|                  " 最大化活动窗口的宽度                
```

窗口切换
```vim
    <C-w>w                 " 窗口循环切换
    <C-w>h/j/k/l           " 左右上下切换
```


### 14 宏
宏---将任意数量的按键操作录制到寄存器，之后进行回放，类此流量回放，自动化测试回放等等
#### 14.1 录制宏
说明：使用某一个寄存器来录制宏操作
```txt
    q{register}                  开始录制宏
    q                            停止录制宏，此时查看寄存器中的内容:reg {register}，就会发现刚刚所有的按键操作
    @{register}                  执行已经录制好的宏
    @@                           重复最近调用的宏
```

#### 14.2 执行方式
* 串行执行                    一旦发生警告，中断执行
* 并行执行                    所有的命令任然是顺序执行，但是某一个按键发生错误时不中断

#### 14.3 黄金法则
确保录制一个宏时，保证每一条命令都可以被重复执行，从而高效准确的重复利用宏

#### 14.4 常见错误
在编写代码时，常常会错误的开启宏录制功能，此时状态栏会显示“记录中”，此时尽快退出


### 17 查找模式
#### 17.1 大小写敏感设置
```vim
set ignorecase          " 但是该命令的副作用非常大，例如影响自动补全行为
\C                      " 强制区分
\c                      " 强制不区分大小写
set smartcase           " 自动识别大小写敏感，一旦查找模式串出现大写，则区分大小写（so good）
```

#### 17.2 正则表达式
vim默认的正则语法风格为POSIX，如果想转为perl/python的正则表达式风格，可以使用very magic模式开关)  
##### 17.2.1 very-magic
```txt
    假定除#、_、大小写字母、数字外的所有字符都具有特殊含义
    命令：
    posix风格：/#\([0-9]\{3}\)用于匹配#03233
    vmagic风格：/\v#([0-9]{3})
```

##### 17.2.2 捕获子匹配
类此正则表达式，使用()进行子匹配的捕获操作，之后使用\1, \2, ..., \9来引用子匹配，\0会引用整个匹配（并非子匹配）

##### 17.2.3 原义查找文本
说明：目标文本可能存在某些正则语法的特殊符号，所以必须消除正则语法，使用very nomagic模式  
匹配#a.b.*c命令：/\V#a.b.*c


### 18 文件格式
说明：vim能够识别的文件格式为：unix/Dos/unix，分别匹配不同的换行操作，从而导致替换操作不一样
#### 18.1 文件格式
```vim
set ffs               支持的文件格式
```

#### 18.2 换行操作
unix:              LF（换行）
Dos:               CRLF
Mac:               LF

#### 18.3 乱码原因
每种文件格式在写入以及读取一行时都是以上述的操作来作为标准，如果用dos去读取unix文件，即试图
从'^J'(LF)中识别'^M^J'(即CRLF)，所以发生错误

#### 18.4 删除^M
```vim
%s/\r//g或者%s/<C-v><C-m>//g
```


### 19 映射
说明：自定义各种快捷键，其中leader命令放在整个vimrc文件的最前面
#### 19.1 组合
##### 19.1.1 前缀
```vim
    nore              " 非递归，默认情况下map是递归的
    n                 " 在普通模式下生效
    v                 " 在可视模式下生效
    i                 " 在插入模式下生效
    c                 " 在命令行模式下生效
```

##### 19.1.2 否定
un--删除映射，其中可以更随上面的各种前缀
```vim
    unmap          " 删除普通模式下的某一个映射
    vunmap         " 删除可视模式下的某一个映射           
```

##### 19.1.3 清除
mapclear---清除相关模式下的所有映射
```vim
    mapclear                   " 清除普通模式下的所有映射
    vmapclear                  " 清除可视模式下的所有映射
```

##### 19.1.4 递归映射
递归：a映射为b，c映射为a，则c映射为b
```vim
    map a b 
    map c 
    " 上述两个命令等价于：map c b
```

#### 19.2 格式
格式：map {参数}  {lhs}  {rhs}，即将{lhs}映射为{rhs}

##### 19.2.1 {rhs}特殊用法
```vim
    .             " 表示不可重映射
    &             " 表示脚本的局部映射可以被重映射
    @             " 表示缓冲区的局部映射
```

##### 19.2.2 特殊参数
```vim
    <silent>                 " 执行键绑定时不在命令行上显示命令
    <special>                " 用于定义某些特殊键有副作用的场合，例如map <special> <F12> /Header<CR>
    <expr>                   " 参数作为表达式来进行计算，即最后为计算后的值，例如inoremap <expr> <C-XXX> ListItem() 
                             " 插入顺序的列表编号，之后返回
    <unique>                 " 定义命令的同时进行键检查，判断是否已经存在该映射
    <Leader>                 " 其中<Leader>的值有mapleader来确定，默认为'\'，很常用哦
```

#### 19.3 键表
```vim
    <k0>-<k9>                " 0-9
    <S->                     " Shirt + 键
    <C->                     " Control + 键
    <M->                     " Alt + 键 或者 meta + 键
    <A->                     " Alt  + 键
    <Esc>                    " Esc键
    <Space>                  " 空格键
    <Tab>                    " tab键
    <CR>                     " Enter键
```

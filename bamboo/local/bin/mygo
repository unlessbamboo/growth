#!/bin/zsh

# 请在本地添加相应数据
. /data/shell/data.sh

bamboo()
{
    ssh ${BAMBOO_NAME}
}

feng()
{
    if [[ ! -n $1 ]];then
        usage
    elif [[ $1 == '0' ]];then
        ssh ${FENG_NAME}
    elif [[ $1 == '1' ]];then
        ssh ${CN_FENG_1_NAME}
    elif [[ $1 == '2' ]];then
        ssh ${CN_FENG_2_NAME}
    else
        usage
    fi
}

vps()
{
    ssh ${VPS_NAME} -p ${VPS_PORT}
}


server()
{
    if [[ ! -n $1 ]];then
        ssh ${SERVER_NAME} -p ${SERVER_PORT}
    elif [[ $1 == 'monitor' ]];then
        ssh "monitor@${SERVER_HOST}" -p ${SERVER_PORT}
    elif [[ $1 == 'visa' ]];then
        sshpass -p ${SERVER_VISA_PASSWD} ssh "visa@${SERVER_HOST}" -p ${SERVER_PORT}
    elif [[ $1 == 'api' ]];then
        sshpass -p ${SERVER_VISA_PASSWD} ssh "apiv1@${SERVER_HOST}" -p ${SERVER_PORT}
    fi
}

crawl02()
{
    if [[ ! -n $1 ]];then
        ssh ${CRAWL02_NAME} -p ${CRAWL02_PORT}
    elif [[ $1 == 'monitor' ]];then
        ssh "monitor@${CRAWL02_HOST}" -p ${CRAWL02_PORT}
    elif [[ $1 == 'visa' ]];then
        sshpass -p ${CRAWL02_VISA_PASSWD} ssh "visa@${CRAWL02_HOST}" -p ${CRAWL02_PORT}
    elif [[ $1 == 'api' ]];then
        sshpass -p ${CRAWL02_VISA_PASSWD} ssh "apiv1@${CRAWL02_HOST}" -p ${CRAWL02_PORT}
    fi
}

testing()
{
    if [[ ! -n $1 ]];then
        ssh ${TEST_NAME} -p ${TEST_PORT}
    elif [[ $1 == 'visa' ]];then
        ssh "visa@${TEST_HOST}" -p ${TEST_PORT}
    elif [[ $1 == 'api' ]];then
        ssh "apiv1@${TEST_HOST}" -p ${TEST_PORT}
    fi
}


batch()
{
    if [[ ! -n $1 ]];then
        ssh ${BATCH_NAME} -p ${BATCH_PORT}
    elif [[ $1 == 'visa' ]];then
        ssh "visa@${BATCH_HOST}" -p ${BATCH_PORT}
    elif [[ $1 == 'api' ]];then
        ssh "apiv1@${BATCH_HOST}" -p ${BATCH_PORT}
    fi
}


db()
{
    # set -x
    ps -ef|grep ${LOCAL_PORT}| grep NPCf| grep -v grep|awk '{print $2}'|xargs kill -9
    if [[ $? != 0 ]];then
        echo "Kill process failed."
        exit 1
    fi
    ssh -L ${LOCAL_PORT}:127.0.0.1:${REMOTE_PORT} ${SERVER_NAME} -NPCf
}


usage()
{
    echo "Go to special machine.
    db              go to online mysql, except aws
    ==============================================
    bamboo          go to personal blog server
    feng            go to hongkong blog server
                    0           --go to HongKong
                    1           --go to CN_feng_1
                    2           --go to CN_feng_2
    vps             go to vps
    ==============================================
    server          go to server
                    visa        --go to visa user
                    apiv1       --go to apiv1 user
                    monitor     --go to monitor user

    crawl           go to crawler server 2
                    visa        --go to visa user
                    apiv1       --go to apiv1

    test            go to test
                    visa        --go to visa user                 
                    api         --go to apiv1 user
    batch           go to batch
                    api         --go to apiv1 user
    "
}


case "$1" in
    db):
        db;;
    bamboo):
        bamboo;;
    feng):
        feng $2;;
    vps):
        vps;;
    server):
        server $2;;
    crawl):
        crawl02 $2;;
    test):
        testing $2;;
    batch):
        batch $2;;
    *)
        usage;;
esac
